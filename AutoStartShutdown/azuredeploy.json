{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "accountName": {
      "type": "String",
      "metadata": {
        "description": "A valid Azure Automation Account Name"
      }
    },
    "regionId": {
      "type": "String",
      "defaultvalue": "usgovvirginia",
      "metadata": {
        "description": "Region of the Azure Automation Account"
      }
    },
    "pricingTier": {
      "type": "String",
      "defaultvalue": "free",
      "metadata": {
        "description": "Pricing tier for the Azure Automation account"
      }
    },
    "resourceGroup": {
      "type": "String",
      "metadata": {
        "description": "This is the Resource Group that the Automation Account belongs to"
      }
    },
    "subscriptionName": {
      "type": "String",
      "metadata": {
        "description": "This is the name of the subscription that the Automation Account belongs to"
      }
    }
  },
  "variables": {
    "AzureRM.Profile": {
      "name": "AzureRm.Profile",
      "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.profile.2.8.0.nupkg"
    },
    "psModules": [
      {
        "name": "AzureRM.Compute",
        "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.compute.2.9.0.nupkg"
      },
      {
        "name": "AzureRm.Resources",
        "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.resources.3.8.0.nupkg"
      },
      {
        "name": "AzureRm.KeyVault",
        "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.keyvault.2.8.0.nupkg"
      },
      {
        "name": "AzureRm.Automation",
        "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.automation.2.8.0.nupkg"
      },
      {
        "name": "AzureRm.OperationalInsights",
        "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.operationalinsights.2.8.0.nupkg"
      },
      {
        "name": "AzureRm.Insights",
        "url": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.insights.2.8.0.nupkg"
      }
    ],
    "runbooks": [
      {
        "name": "AutoStartShutdown",
        "version": "1.0.0.0",
        "description": "Runbook for automatically starting and shutting down VMs based on a tag and schedule",
        "type": "PowerShell",
        "Id": "",
        "scriptUri": "[concat(variables('runbooklocation'),'/AutoStartShutdown.ps1')]"
      }
    ],
    "automationVariables": [
      {
        "name": "StartShutdown_AutomationAcct",
        "description": "Azure Automation Account Name",
        "value": "[concat('\"',parameters('accountName'),'\"')]"
      },
      {
        "name": "StartShutdown_ResourceGroup",
        "description": "Azure Resource Group the Automation Account belongs to",
        "value": "[concat('\"',parameters('resourceGroup'),'\"')]"
      },
      {
        "name": "StartShutdown_SubscriptionName",
        "description": "Azure Subscription Name the Automation Account belongs to",
        "value": "[concat('\"',parameters('subscriptionName'),'\"')]"
      },
      {
        "name": "StartShutdown_TagName",
        "description": "Azure Tag Name for VMs and Resource Groups",
        "value": "AutoStartShutdown"
      },
      {
        "name": "StartShutdown_TagValue",
        "description": "Azure Tag Name for VMs and Resource Groups",
        "value": "True"
      }
    ],
    "runbooklocation": "https://github.com/kylgrn/AutoStartShutdown/blob/master/AutoStartShutdown/AutoStartShutdown/AutoStartShutdown",
    "StartStopVMVersion": "1.0.0.0"
  },
  "resources": [
    {
      "type": "Microsoft.Automation/automationAccounts",
      "name": "[parameters('accountName')]",
      "apiVersion": "2015-10-31",
      "location": "[parameters('regionId')]",
      "tags": {
        "StartStopVMVersion": "[variables('StartStopVMVersion')]"
      },
      "properties": {
        "sku": {
          "name": "OMS"
        }
      }
    }

  ],
  "outputs": {}
}
